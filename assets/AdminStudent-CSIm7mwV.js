import{r as a,ar as v,j as e,as as S,at as k,c as N,b as A,a6 as _,a7 as C,w as b,d as f}from"./index-D7gKvvQE.js";import{T as L}from"./TableSkeleton-BK4KEW82.js";const D=()=>{const[r,h]=a.useState([]),[o,c]=a.useState(null),[x,n]=a.useState(!1),m=async()=>{n(!0);try{const l=await v();h(l)}catch(l){console.error("Error fetching students:",l),c(l)}finally{n(!1)}};return a.useEffect(()=>{m()},[]),{students:r,refetch:m,loading:x}},$=r=>{const[h,o]=a.useState(null),[c,x]=a.useState(!1),n=a.useRef(null);return a.useEffect(()=>{if(!r)return;const l=window.location.protocol==="https:"?"wss":"ws",g=window.location.host,y=`${l}://${g}/ws/admin/student_analytics/${r}/`,d=new WebSocket(y);return n.current=d,d.onopen=()=>{x(!0)},d.onmessage=t=>{try{const i=JSON.parse(t.data);i.type==="analytics.update"&&o(i.data)}catch(i){console.error("WS parse error",i)}},d.onclose=()=>{x(!1)},d.onerror=t=>{console.error("WS error",t)},()=>{d.close()}},[r]),{data:h,connected:c,send:l=>{n.current&&n.current.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify(l))}}},E=({studentId:r,onClose:h})=>{const{data:o}=$(r),[c,x]=a.useState(!0),[n,m]=a.useState(null);if(a.useEffect(()=>{let s=!0;return(async()=>{try{const j=await N.get(`admin/students/${r}/analytics/`);s&&m(j.data)}catch(j){console.error(j)}finally{s&&x(!1)}})(),()=>{s=!1}},[r]),a.useEffect(()=>{o&&m(o)},[o]),c||!n)return e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white p-6 rounded shadow w-11/12 md:w-3/4 lg:w-2/3",children:"Loading..."})});const{name:l,email:g,joined_date:y,last_login:d,status:t,courses:i,contests:p,summary:u}=n;return e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs(S.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"bg-white rounded-lg shadow-lg w-11/12 md:w-4/5 lg:w-3/4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700",children:l}),e.jsx("div",{className:"text-sm text-gray-500",children:g})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`px-3 py-1 rounded text-white ${t==="Active"?"bg-green-500":"bg-red-500"}`,children:t}),e.jsx("button",{onClick:h,className:"p-2 rounded hover:bg-gray-100",children:e.jsx(k,{})})]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-indigo-50 p-4 rounded",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Tests"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:u.total_tests})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Attempted"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:u.attempted})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Average Score"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:u.average_score})]})]}),e.jsx("div",{className:"bg-white border rounded",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Title"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Max Marks"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Student Marks"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500",children:"Attendance"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Rank"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Progress"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{className:`${s.attendance_status==="Absent"?"bg-red-50 text-gray-400":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:s.title}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(s.date_conducted).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:s.max_marks}),e.jsx("td",{className:`px-4 py-3 text-sm text-right ${s.attendance_status==="Absent"?"text-gray-400":"text-indigo-600"}`,children:s.student_marks}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.attendance_status==="Absent"?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}`,children:s.attendance_status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:s.rank??"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[s.progress_percentage,"%"]})]},s.id))})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"bg-white p-4 rounded mb-4",children:[e.jsx("h4",{className:"text-sm text-gray-500",children:"Attendance %"}),e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:[u.attendance_percentage,"%"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded",children:[e.jsx("h4",{className:"text-sm text-gray-500",children:"Best Rank"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:u.best_rank??"-"})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:async()=>{const s=t!=="Active";try{await N.patch(`admin/students/${r}/block/`,{is_active:s}),n.status=s?"Active":"Blocked"}catch(w){console.error(w)}},className:"mt-4 w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded",children:"Block"})})]})]})]})})},T=()=>{const{students:r,refetch:h,loading:o}=D(),[c,x]=a.useState(""),[n,m]=a.useState(null),[l,g]=a.useState(!1),y=async(t,i)=>{try{const p=await N.patch(`user/${t}/status/`,{is_active:!i});console.log(p),h(),i?f(200,"Student blocked successfully"):f(200,"Student Unblocked successfully")}catch(p){console.log(p),f(200,"Please try again later!")}},d=r.filter(t=>t.username.toLowerCase().includes(c.toLowerCase())||t.email.toLowerCase().includes(c.toLowerCase()));return e.jsxs(e.Fragment,{children:[o?e.jsx(L,{}):e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6 mt-10",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-700 mb-2 sm:mb-0",children:"Students"}),e.jsx("input",{type:"text",placeholder:"Search",className:"border p-2 rounded w-full sm:w-auto",value:c,onChange:t=>x(t.target.value)})]}),e.jsx("nav",{className:"flex mb-8","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[e.jsx("li",{className:"inline-flex items-center",children:e.jsxs(A,{to:"/admin",className:"inline-flex items-center text-sm font-medium text-gray-700 hover:text-indigo-600",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Dashboard"]})}),e.jsx("li",{"aria-current":"page",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"ml-1 text-sm font-medium text-gray-500 md:ml-2",children:"Student"})]})})]})}),e.jsx("div",{className:"overflow-x-auto bg-white shadow-md rounded-lg",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["No","Username","First Name","Last Name","Email","Created At","Last Login","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t},t))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map((t,i)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.first_name||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.last_name||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.date_joined?b(new Date(t.date_joined)):"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.last_login?b(new Date(t.last_login)):"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>y(t.id,t.is_active),className:`${t.is_active?"bg-red-500 hover:bg-red-700":"bg-green-500 hover:bg-green-700"} text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out`,children:t.is_active?"Block":"Unblock"}),e.jsx("button",{onClick:()=>{m(t),g(!0)},className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out",children:"View Analytics"})]})]},t.id))})]})})]})}),l&&n&&e.jsx(E,{studentId:n.id,onClose:()=>g(!1)})]})};export{T as default};
