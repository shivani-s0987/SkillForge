import{r as d,a as N,a4 as w,j as e,H as v,e as S,c as m}from"./index-D7gKvvQE.js";function _(){return new URLSearchParams(S().search)}const R=()=>{const a=_().get("contest_id"),[r,t]=d.useState([]),[s,i]=d.useState(!0),[o,l]=d.useState(null),[u,f]=d.useState(null),b=N(),{user:x}=w(n=>n.auth),[h,p]=d.useState(!1);d.useEffect(()=>{if(!a)return l("Missing contest id");(async()=>{try{const g=await m.get(`summarized-keynotes/?contest_id=${a}`);t(g.data);try{const y=await m.get(`contest/${a}/`);f(y.data)}catch{}}catch(g){console.error(g),l("Failed to load summaries")}finally{i(!1)}})()},[a]);const j=async()=>{if(a){p(!0);try{await m.post("summarized-keynotes/generate/",{contest_id:a});const n=await m.get(`summarized-keynotes/?contest_id=${a}`);t(n.data)}catch(n){console.error(n),l("Failed to regenerate summaries")}finally{p(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-blue-50 text-gray-900",children:[e.jsx(v,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-8 py-10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-10 border-b pb-5",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-extrabold text-indigo-700 drop-shadow-md tracking-tight",children:"📘 AI Summarized Key Notes"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:[x&&(x.role==="tutor"||x.is_staff)&&e.jsx("button",{onClick:j,disabled:h,className:`px-6 py-2 rounded-lg font-semibold text-white text-sm shadow-lg transition-all ${h?"bg-indigo-400 cursor-wait":"bg-gradient-to-r from-indigo-600 to-blue-500 hover:from-indigo-700 hover:to-blue-600"}`,children:h?"Regenerating...":"🔁 Regenerate"}),e.jsx("button",{onClick:()=>b(-1),className:"px-4 py-2 text-indigo-600 font-medium border border-indigo-400 rounded-lg hover:bg-indigo-100 transition-all",children:"← Back"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-blue-100 p-5 rounded-xl shadow-sm border-l-4 border-indigo-500 mb-8",children:e.jsxs("p",{className:"text-lg font-medium text-gray-700",children:[e.jsx("span",{className:"font-bold text-indigo-800 underline",children:"Status:"})," ",e.jsx("span",{className:"font-semibold text-blue-700 uppercase",children:(u==null?void 0:u.ai_summary_status)||"pending"})]})}),s&&e.jsx("p",{className:"text-center text-gray-600 italic",children:"Loading summaries..."}),o&&e.jsx("p",{className:"text-red-500 text-center font-medium",children:o}),!s&&!o&&e.jsxs("div",{className:"space-y-10",children:[r.length===0&&e.jsx("p",{className:"text-center text-gray-600 bg-white p-6 rounded-xl shadow",children:"No summaries available yet. They will be generated once results are published."}),r.map(n=>e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl border border-gray-100 hover:shadow-2xl transition-transform hover:-translate-y-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-indigo-700 underline decoration-indigo-400 mb-2",children:"🧩 Question"}),e.jsx("p",{className:"text-gray-900 text-xl leading-relaxed font-semibold",children:n.question_text})]}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(k,{text:n.summary_text})}),e.jsx("div",{className:"border-t-2 border-dashed border-indigo-200 my-6"}),e.jsx("h3",{className:"text-2xl font-bold text-blue-700 underline mb-4",children:"💡 AI Key Note Summary"}),e.jsx(C,{text:n.summary_text})]},n.id))]})]})]})};function k({text:c}){const a=async()=>{try{await navigator.clipboard.writeText(c||""),alert("✅ Summary copied to clipboard!")}catch(r){console.error("Copy failed",r)}};return e.jsx("button",{onClick:a,title:"Copy summary",className:"bg-gradient-to-r from-indigo-600 to-blue-500 hover:from-indigo-700 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-md transition-all",children:"📋 Copy Summary"})}function C({text:c}){if(!c)return e.jsx("div",{className:"text-gray-500 italic",children:"Not generated yet"});const a=[],r=c.split(/\r?\n/);let t=0;for(;t<r.length;){const s=r[t].trimEnd();if(s.startsWith("```")){const o=s.slice(3).trim();t++;const l=[];for(;t<r.length&&!r[t].startsWith("```");)l.push(r[t]),t++;t++,a.push({type:"code",lang:o,content:l.join(`
`)});continue}if(/^[-*]\s+/.test(s)){const o=[];for(;t<r.length&&/^[-*]\s+/.test(r[t].trim());)o.push(r[t].trim().replace(/^[-*]\s+/,"")),t++;a.push({type:"list",items:o});continue}if(/^#{1,6}\s+/.test(s)||/^Answer:/.test(s)||/^Explanation:/.test(s)||/^Summary:/.test(s)){a.push({type:"heading",content:s.replace(/^#+\s*/,"")}),t++;continue}const i=[];for(;t<r.length&&r[t].trim()!=="";)i.push(r[t]),t++;for(i.length&&a.push({type:"paragraph",content:i.join(" ").trim()});t<r.length&&r[t].trim()==="";)t++}return e.jsx("div",{className:"prose prose-lg max-w-none text-gray-800 leading-relaxed",children:a.map((s,i)=>s.type==="code"?e.jsx("pre",{className:"bg-gray-900 text-green-300 rounded-xl p-4 overflow-auto text-sm shadow-inner mb-4",children:e.jsx("code",{children:s.content})},i):s.type==="list"?e.jsx("ul",{className:"list-disc list-inside mb-4 pl-5 text-gray-700 space-y-2",children:s.items.map((o,l)=>e.jsx("li",{children:e.jsx("span",{className:"font-medium text-gray-800",children:o})},l))},i):s.type==="heading"?e.jsx("h4",{className:"mt-6 mb-2 text-xl text-indigo-700 font-semibold underline decoration-indigo-400",children:s.content},i):e.jsx("p",{className:"mb-4 text-gray-900 font-medium",children:s.content},i))})}export{R as default};
