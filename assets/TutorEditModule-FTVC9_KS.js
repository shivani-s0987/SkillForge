import{r as d,aL as N,A as w,a as E,j as t,L as M,c as x,d as y}from"./index-D7gKvvQE.js";const S=e=>{const[c,m]=d.useState(),[r,u]=d.useState(),f=async()=>{try{const i=await N(e);m(i)}catch(i){console.log(i),u(i)}};return d.useEffect(()=>{f()},[e]),{moduleDetails:c,error:r}},F=()=>{const[e,c]=d.useState({title:"",description:"",video:"",notes:""}),[m,r]=d.useState(!1),{id:u}=w(),f=E(),{moduleDetails:i}=S(u);console.log(i),d.useEffect(()=>{i&&c(i)},[i]);const b=async a=>{a.preventDefault(),r(!0);const o=new FormData;o.append("title",e.title),o.append("description",e.description);const s=l=>{const g=/media\/(module_videos|module_notes)\/(.+)/,n=l.match(g);return console.log("match ====",n),console.log("match2 ====",n[1]+"/"+n[2]),n?n[1]+"/"+n[2]:l};if(e.video&&typeof e.video=="string"){const l=s(e.video);o.append("video",l)}else if(e.video&&typeof e.video!="string"){const l=await h(e.video,"video");o.append("video",l.videoKey)}if(e.notes&&typeof e.notes=="string"){const l=s(e.notes);o.append("notes",l)}else if(e.notes&&typeof e.notes!="string"){const l=await h(e.notes,"notes");o.append("notes",l.notesKey)}try{(await x.patch(`modules/${u}/`,o,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(y(200,"Module has been updated successfully"),f("/tutor/courses"))}catch(l){console.log(l),y(400,"Error updating module. Please try again.")}finally{r(!1)}},h=async(a,o)=>{try{const s=await v(a,o);return await j(a,s.presignedUrl),{videoKey:s.key}}catch(s){throw console.error(s),new Error(`Error uploading ${o} to S3`)}finally{r(!1)}},v=async(a,o)=>{try{return(await x.get(`/get-presigned-url?filename=${a.name}&file_type=${o}`)).data}catch(s){throw console.error(s),new Error("Error getting presigned URL")}finally{r(!1)}},j=async(a,o)=>{try{const s=await fetch(o,{method:"PUT",body:a,headers:{"Content-Type":a.type}});if(!s.ok)throw new Error(`Failed to upload file to S3: ${s.statusText}`)}catch(s){throw console.error(s),new Error("Error uploading file to S3")}finally{r(!1)}},p=a=>{const{name:o,value:s,files:l}=a.target;c(g=>({...g,[o]:o==="video"||o==="notes"?l[0]:s}))};return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Edit Module"}),t.jsxs("form",{onSubmit:b,className:"bg-white p-6 border rounded-lg shadow-md",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Module Details"}),t.jsxs("div",{className:"relative mb-4 p-4 border rounded-lg",children:[t.jsxs("div",{className:"mb-4 flex gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"module-title",className:"block text-gray-700 mb-1",children:"Module Title"}),t.jsx("input",{type:"text",id:"module-title",name:"title",value:e.title,onChange:p,className:"w-full p-2 border border-gray-300 rounded",placeholder:"Module Title"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"module-description",className:"block text-gray-700 mb-1",children:"Description"}),t.jsx("textarea",{id:"module-description",name:"description",value:e.description,onChange:p,className:"w-full p-2 border border-gray-300 rounded",placeholder:"Module Description"})]})]}),t.jsxs("div",{className:"mb-4 flex gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"module-video",className:"block text-gray-700 mb-1",children:"Video URL"}),t.jsx("input",{type:"file",accept:"video/*",id:"module-video",name:"video",onChange:p,className:"text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",placeholder:"Video URL"}),e.video&&typeof e.video=="string"&&t.jsxs("p",{className:"mt-2 text-gray-600",children:["Current file: ",e.video.split("/").pop()]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"module-notes",className:"block text-gray-700 mb-1",children:"Study Notes"}),t.jsx("input",{id:"module-notes",name:"notes",type:"file",onChange:p,className:"text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",placeholder:"Study Notes"}),e.notes&&typeof e.notes=="string"&&t.jsxs("p",{className:"mt-2 text-gray-600",children:["Current file: ",e.notes.split("/").pop()]})]})]})]})]}),t.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 transition duration-300",disabled:m,children:m?t.jsx(M,{}):"Update Module"})]})]})};export{F as default};
