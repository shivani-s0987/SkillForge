import{r as h,A as U,a as C,j as s,L as $,aK as k,c as b,d as y}from"./index-D7gKvvQE.js";const R=()=>{const[i,d]=h.useState([{title:"",description:"",video:null,notes:null,duration:""}]),[m,c]=h.useState(!1),{id:x}=U(),v=C(),j=async o=>{if(c(!0),o.preventDefault(),!k(i)){c(!1);return}const t=await Promise.all(i.map(async a=>{const{videoKey:l,notesKey:r}=await w(a);return{title:a.title,description:a.description,duration:a.duration,video:l,notes:r}})),e=new FormData;e.append("course",x),e.append("modules",JSON.stringify(t));try{(await b.post("modules/",e,{headers:{"Content-Type":"multipart/form-data"}})).status===201&&(y(200,"Modules have been added successfully"),v("/tutor/courses"))}catch(a){console.error(a),y(400,"Error uploading modules. Please try again.")}finally{c(!1)}},w=async o=>{try{const t=await p(o.video,"video");await g(o.video,t.presignedUrl);let e=null;return o.notes&&(e=await p(o.notes,"notes"),await g(o.notes,e.presignedUrl)),{videoKey:t.key,notesKey:e?e.key:null}}catch(t){throw console.error(t),new Error("Error uploading files to S3")}finally{c(!1)}},p=async(o,t)=>{try{return(await b.get(`/get-presigned-url?filename=${encodeURIComponent(o.name)}&file_type=${t}&content_type=${encodeURIComponent(o.type)}`)).data}catch(e){throw console.error("Error getting presigned URL:",e),new Error("Error getting presigned URL")}},g=async(o,t)=>{try{console.log("Starting upload to:",t),console.log("File type:",o.type),console.log("File size:",o.size);const e=new AbortController,a=setTimeout(()=>e.abort(),5*60*1e3),l=await fetch(t,{method:"PUT",body:o,headers:{"Content-Type":o.type},signal:e.signal});if(clearTimeout(a),!l.ok){const r=await l.text();throw console.error("Upload failed:",{status:l.status,statusText:l.statusText,errorText:r,headers:Object.fromEntries(l.headers.entries())}),new Error(`Upload failed: ${l.status} ${l.statusText}`)}return l}catch(e){throw console.error("Upload error details:",{name:e.name,message:e.message,stack:e.stack}),e}},u=(o,t)=>{const{name:e,value:a,files:l}=t.target,r=[...i];if(e==="video"){const f=l[0],n=document.createElement("video");n.preload="metadata",n.onloadeddata=function(){window.URL.revokeObjectURL(n.src);const T=Math.round(n.duration);r[o]={...r[o],duration:T,video:f},d(r)},n.src=URL.createObjectURL(f)}else e==="notes"?r[o]={...r[o],[e]:l[0]}:r[o]={...r[o],[e]:a};d(r)},N=()=>{d(o=>[...o,{title:"",description:"",video:"",notes:""}])},M=o=>{d(t=>t.filter((e,a)=>a!==o))};return s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Add Modules"}),s.jsxs("form",{onSubmit:j,className:"bg-white p-6 rounded-lg border shadow-md",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Modules"}),i.map((o,t)=>s.jsxs("div",{className:"relative mb-4 p-4 border rounded-lg",children:[s.jsxs("div",{className:"mb-4 flex gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{htmlFor:`module-title-${t}`,className:"block text-gray-700 mb-1",children:"Module Title"}),s.jsx("input",{type:"text",id:`module-title-${t}`,name:"title",value:o.title,onChange:e=>u(t,e),className:"w-full p-2 border border-gray-300 rounded",placeholder:"Module Title"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{htmlFor:`module-description-${t}`,className:"block text-gray-700 mb-1",children:"Description"}),s.jsx("textarea",{id:`module-description-${t}`,name:"description",value:o.description,onChange:e=>u(t,e),className:"w-full p-2 border border-gray-300 rounded",placeholder:"Module Description"})]})]}),s.jsxs("div",{className:"mb-4 flex gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{htmlFor:`module-video-${t}`,className:"block text-gray-700 mb-1",children:"Video URL"}),s.jsx("input",{type:"file",accept:"video/*",id:`module-video-${t}`,name:"video",onChange:e=>u(t,e),className:"text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{htmlFor:`module-notes-${t}`,className:"block text-gray-700 mb-1",children:"Study Notes"}),s.jsx("input",{id:`module-notes-${t}`,name:"notes",type:"file",onChange:e=>u(t,e),className:"text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"})]})]}),t>0&&s.jsx("button",{type:"button",onClick:()=>M(t),className:"absolute top-2 right-2",children:s.jsx("img",{src:"/close-icon.png",alt:"remove",className:"w-6 h-6"})})]},t)),s.jsx("button",{type:"button",onClick:N,className:"text-indigo-600 hover:underline",children:"Add Another Module"})]}),s.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 transition duration-300",disabled:m,children:m?s.jsx($,{}):"Create Modules"})]})]})};export{R as default};
