import{a as b,j as e,r as o,as as f,c as w}from"./index-FF5MpAmF.js";import{R as c,B as _,X as p,Y as v,T as y,a as C,L as S,b as M,P as A,c as K,C as L}from"./PieChart-CUz2m6xT.js";import"./index-CrkXov_Y.js";const T=({student:s})=>{const n=b();return e.jsxs("div",{onClick:()=>n(`/tutor/student/${s.id}`),className:"cursor-pointer flex items-center space-x-4 p-3 border-b last:border-b-0 hover:bg-indigo-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-semibold",children:(s.name||"U").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Courses: ",s.enrolled_courses_count," â€¢ Tests: ",s.total_tests]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-indigo-600",children:[s.completion_pct??0,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Completion"})]})]})},D=({data:s})=>{const n=s.enrollments_over_time&&s.enrollments_over_time.length?s.enrollments_over_time:Array.from({length:12}).map((t,a)=>({month:`M${a+1}`,count:Math.floor(Math.random()*20)})),i=s.scores_trend&&s.scores_trend.length?s.scores_trend:Array.from({length:8}).map((t,a)=>({name:`W${a+1}`,score:Math.floor(40+Math.random()*60)})),d=[{name:"Completed",value:Math.random()*60+20},{name:"Ongoing",value:Math.random()*20+5},{name:"Not Started",value:Math.random()*20}],r=["#7c3aed","#a78bfa","#c7d2fe"];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{style:{height:240},children:e.jsx(c,{children:e.jsxs(_,{data:n,children:[e.jsx(p,{dataKey:"month"}),e.jsx(v,{}),e.jsx(y,{}),e.jsx(C,{dataKey:"count",fill:"#7c3aed"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{style:{height:200},className:"bg-white p-3 rounded",children:e.jsx(c,{children:e.jsxs(S,{data:i,children:[e.jsx(p,{dataKey:"name"}),e.jsx(v,{}),e.jsx(y,{}),e.jsx(M,{type:"monotone",dataKey:"score",stroke:"#7c3aed",strokeWidth:2})]})})}),e.jsx("div",{style:{height:200},className:"bg-white p-3 rounded flex items-center justify-center",children:e.jsx(c,{children:e.jsx(A,{children:e.jsx(K,{data:d,dataKey:"value",nameKey:"name",outerRadius:60,fill:"#8884d8",children:d.map((t,a)=>e.jsx(L,{fill:r[a%r.length]},a))})})})})]})]})},R=({query:s,onQueryChange:n,onApply:i})=>{const[d,r]=o.useState("all");return e.jsxs(f.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 bg-white p-4 rounded-lg shadow flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{value:s,onChange:t=>n&&n(t.target.value),onKeyDown:t=>{t.key==="Enter"&&i&&i()},placeholder:"Search students, emails...",className:"px-3 py-2 border rounded w-64"}),e.jsxs("select",{value:d,onChange:t=>r(t.target.value),className:"px-3 py-2 border rounded",children:[e.jsx("option",{value:"all",children:"All Courses"}),e.jsx("option",{value:"course1",children:"Course 1"})]}),e.jsx("button",{onClick:()=>i&&i(),className:"bg-indigo-600 text-white px-4 py-2 rounded",children:"Apply"})]}),e.jsx("div",{className:"mt-3 lg:mt-0 text-sm text-gray-500",children:"Filter by course, performance or tests. Live updates every 30s."})]})},B=()=>{var x,m,h,g,u,j;const[s,n]=o.useState({students:[],aggregated:{},time_series:{}}),[i,d]=o.useState(!0),[r,t]=o.useState(""),a=async()=>{try{const l={};r&&(l.q=r);const N=await w.get("student-analytics/",{params:l});n(N.data)}catch(l){console.error(l)}finally{d(!1)}};return o.useEffect(()=>{a();const l=setInterval(a,3e4);return()=>clearInterval(l)},[r]),e.jsx(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-semibold text-indigo-700",children:"Student Analytics"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Real-time student performance and course insights"}),e.jsx(R,{query:r,onQueryChange:t,onApply:a}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"col-span-1 bg-white p-4 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Total Students"}),e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:((x=s.aggregated)==null?void 0:x.total_students)??"-"})]}),e.jsxs("div",{className:"col-span-1 bg-white p-4 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Average Score"}),e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:((m=s.aggregated)==null?void 0:m.average_score)??"-"})]}),e.jsxs("div",{className:"col-span-1 bg-white p-4 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Top Performer"}),e.jsx("div",{className:"text-lg font-semibold",children:((u=(g=(h=s.aggregated)==null?void 0:h.top_performers)==null?void 0:g[0])==null?void 0:u.user__username)??"-"})]}),e.jsxs("div",{className:"col-span-1 bg-white p-4 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Avg Completion %"}),e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:(j=s.aggregated)!=null&&j.average_score?Math.round(s.aggregated.average_score):"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-white p-6 rounded-lg shadow",children:e.jsx(D,{data:s.time_series})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Students"}),i?e.jsx("div",{children:"Loading..."}):s.students.slice(0,6).map(l=>e.jsx(T,{student:l},l.id))]})]})]})})};export{B as default};
